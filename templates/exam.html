<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <title>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    body {
        font-family: 'Tajawal', Arial, sans-serif;
        background-color: #f4f6f9;
        margin: 0;
        padding: 0;
    }

    .timer {
        position: sticky;
        top: 0;
        z-index: 1000;
        background-color: #003366;
        color: white;
        padding: 10px;
        text-align: center;
        font-family: 'Tajawal', Arial, sans-serif;
    }
    .timer-header {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        font-size: 1.1em;
        font-weight: bold;
    }
    .timer-time { margin-top: 4px; font-size: 1.1em; }
    .timer-logo { height: 28px; width: auto; }

    .warning-area {
        margin: 20px auto;
        padding: 10px;
        max-width: 700px;
        background-color: #fffbe6;
        border: 1px solid #ff9900;
        border-radius: 6px;
        color: #cc0000;
        font-weight: bold;
        text-align: center;
        display: none;
    }
    .warning-area.blink { animation: blink 1s step-start infinite; }
    @keyframes blink { 50% { background-color: #fff2cc; } }

    #instruction {
        display: none;
        background-color: #ffffff;
        border: 1px solid #e6c200;
        padding: 20px;
        margin: 20px auto;
        max-width: 800px;
        border-radius: 6px;
        font-size: 1.7em;
        line-height: 1.6;
    }

    #examTitle {
        display: none;
        text-align: center;
        font-size: 1.5em;
        font-weight: bold;
        margin-top: 20px;
        color: #003366;
    }

    .question-box {
        display: none;
        background: white;
        padding: 20px;
        border-radius: 5px;
        margin: 10px auto;
        max-width: 700px;
        border: 1px solid #ccc;
    }
    .question-box.active { display: block; }

    .nav-buttons, .submit-btn { text-align: center; margin: 20px; }
    button {
        padding: 10px 20px; margin: 5px; border: none; border-radius: 5px;
        cursor: pointer; font-size: 1em; background-color: #003366; color: white;
    }
    button:hover:not(.disabled) { background-color: #002244; }
    button.disabled { background-color: #ccc; color: #666; cursor: not-allowed; }

    #questionNav {
        display: flex; flex-wrap: wrap; justify-content: center; gap: 8px;
        margin: 20px auto; max-width: 700px;
    }
    #questionNav span {
        display: inline-block; min-width: 40px; padding: 8px 12px; border-radius: 8px;
        background-color: #ffffff; cursor: pointer; text-align: center; font-weight: bold;
        border: 1px solid #0b5394; transition: background-color 0.3s ease, border 0.3s ease;
    }
    #questionNav span.answered { background-color: #0b5394; color: #ffffff; }
    #questionNav span.unanswered { border: 2px solid red; }
    #questionNav span.active { font-weight: bold; border: 2px solid #003366; }

    #samplePreview { background-color: #fdfce5; border: 1px solid #ff9900; padding: 20px; margin: 20px auto; max-width: 700px; border-radius: 6px; }
    #samplePreview h3 { color: #003366; }

    #honorModal button {
        background-color: #003366; color: white; font-size: 1em;
        padding: 10px 20px; border-radius: 5px; border: none;
    }
    #honorModal button:hover { background-color: #002244; }

    #progressContainer {
        display: none;
        width: 700px; height: 15px; background-color: #e0e0e0;
        margin: 0 auto; direction: ltr; border-radius: 5px; overflow: hidden;
    }
    #progressBar {
        height: 100%; width: 0%;
        background: linear-gradient(to left, #fffffe 0%, #a1cbe3 25%, #2cb3e0 50%, #107bb0 100%);
        transition: width 0.3s ease; border-radius: 0 5px 5px 0;
    }
</style>
</head>
<body>

<div class="timer" id="timer">
    <div class="timer-header">
        <img src="{{ url_for('data_file', filename='logo.png') }}" alt="Ø´Ø¹Ø§Ø±" class="timer-logo">
        <span>Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠ ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</span>
    </div>
    <div class="timer-time">
        Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="timerText">--:--</span>
    </div>
</div>

<div id="honorModal">
    <div style="background: white; max-width: 600px; margin: 40px auto; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.2); text-align: justify; font-size: 2em;">
        <p> Ø£Ù‚Ø± Ø£Ù†Ø§ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…/Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„ÙˆØ¸ÙŠÙØ© Ø¨Ø£Ù†Ù†ÙŠ Ø³Ø£Ù‚ÙˆÙ… Ø¨ØªØ£Ø¯ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¨Ù†ÙØ³ÙŠØŒ
        Ø¨ÙƒÙ„ Ù†Ø²Ø§Ù‡Ø© ÙˆØ£Ù…Ø§Ù†Ø©ØŒ ÙˆØ¯ÙˆÙ† Ø§Ù„Ø§Ø³ØªØ¹Ø§Ù†Ø© Ø¨Ø£ÙŠ ÙˆØ³ÙŠÙ„Ø© ØºÙŠØ± Ù…Ø´Ø±ÙˆØ¹Ø© Ø£Ùˆ Ø£ÙŠ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø®Ø§Ø±Ø¬ÙŠØ©... </p>
        <button onclick="startHonor()">âœ… Ø£ÙˆØ§ÙÙ‚ ÙˆØ£Ø¨Ø¯Ø£</button>
    </div>
</div>

<div id="instruction">
    Ø¹Ø²ÙŠØ²ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± ... (ØªØ¹Ù„ÙŠÙ…Ø§Øª)
    <div id="samplePreview">
        <h3 style="text-align:center;">ğŸ” Ù…Ø«Ø§Ù„ ØªÙˆØ¶ÙŠØ­ÙŠ Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
        <div style="background-color:#ffffff;border:1px solid #ccc;padding:15px;border-radius:5px;">
            <p><strong>Ø³: Ù‡Ø°Ø§ Ø³Ø¤Ø§Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ ÙÙ‚Ø· Ù„Ù„ØªÙˆØ¶ÙŠØ­</strong></p>
            <label><input type="radio" disabled> Ø¥Ø¬Ø§Ø¨Ø© 1</label><br>
            <label><input type="radio" disabled> Ø¥Ø¬Ø§Ø¨Ø© 2</label><br>
            <label><input type="radio" disabled> Ø¥Ø¬Ø§Ø¨Ø© 3</label><br>
            <label><input type="radio" disabled> Ø¥Ø¬Ø§Ø¨Ø© 4</label><br>
            <div style="margin-top:15px;">
                <button disabled>Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                <button disabled>Ø§Ù„ØªØ§Ù„ÙŠ</button>
                <button disabled style="background-color:#ccc;">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
            <div style="margin-top:20px;font-size:.95em;">
                <p>â¬†ï¸ Ù‡Ø°Ø§ Ù‡Ùˆ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø³Ø¤Ø§Ù„...</p>
                <p>â¡ï¸ Ø²Ø± <strong>Ø§Ù„ØªØ§Ù„ÙŠ</strong>...</p>
                <p>âœ… Ø²Ø± <strong>Ø¥Ø±Ø³Ø§Ù„</strong>...</p>
            </div>
        </div>
    </div>
</div>

<div id="warningArea" class="warning-area"></div>

<h2 id="examTitle">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>

<div id="questionNav"></div>

<div id="progressContainer"><div id="progressBar"></div></div>

<form id="examForm" method="post" action="/submit" style="display:none" onsubmit="return confirmIncompleteSubmission();">
    {% for q in questions %}
        <div class="question-box" id="q{{ loop.index0 }}">
            <p><strong>Ø³Ø¤Ø§Ù„ Ø±Ù‚Ù… {{ loop.index }}:</strong> {{ q['question_ar'] }}</p>
            {% set q_idx = loop.index0 %}
            {% for opt in ['A','B','C','D'] %}
                <label>
                    <input type="radio" name="{{ q['id'] }}" value="{{ opt }}" onchange="markAnswered({{ q_idx }})">
                    {{ q['answers'][opt + '_ar'] }}
                </label><br>
            {% endfor %}
        </div>
    {% endfor %}

    <div class="nav-buttons">
        <button type="button" id="prevBtn" class="disabled" onclick="prevQuestion()" disabled>Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
        <button type="button" id="nextBtn" class="disabled" onclick="nextQuestion()" disabled>Ø§Ù„ØªØ§Ù„ÙŠ</button>
    </div>

    <div class="submit-btn">
        <button type="submit" id="submitBtn" class="disabled" disabled>Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
</form>

<script>
    // ====== EASY CONTROLS HERE ======
    const examDurationMinutes = 60;     // Ù…Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Ø¯Ù‚ÙŠÙ‚Ø©)
    const waitBeforeStartSeconds = 5;  // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡ (Ø«ÙˆØ§Ù†Ù) â€” ØºÙŠÙ‘Ø±Ù‡Ø§ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±

    const totalQuestions = {{ questions|length }};
    let currentQuestion = 0;
    const answered = Array(totalQuestions).fill(false);

    // timeLeft = Ù…Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± + ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡
    let timeLeft = (examDurationMinutes * 60) + waitBeforeStartSeconds;
    let warned = {};

    function startHonor() {
        document.getElementById("honorModal").style.display = "none";
        document.getElementById("instruction").style.display = "block";
        updateTimer();
    }

    function showWarning(msg, blink) {
        const warning = document.getElementById("warningArea");
        warning.innerText = msg;
        warning.style.display = "block";
        warning.classList.toggle("blink", !!blink);
    }

    function showQuestion(i) {
        document.querySelectorAll(".question-box").forEach((box, index) => {
            box.classList.toggle("active", index === i);
        });
        currentQuestion = i;
        updateNavStatus();
        updateProgressBar();

        const currentBox = document.getElementById("q" + i);
        const firstInput = currentBox.querySelector('input[type="radio"]');
        if (firstInput) firstInput.focus();
    }

    function prevQuestion() { if (currentQuestion > 0) showQuestion(currentQuestion - 1); }
    function nextQuestion() { if (currentQuestion < totalQuestions - 1) showQuestion(currentQuestion + 1); }

    function markAnswered(index) {
        answered[index] = true;
        updateNavStatus();
        updateProgressBar();
    }

    function updateNavStatus() {
        document.querySelectorAll("#questionNav span").forEach((el, i) => {
            el.className = answered[i] ? 'answered' : 'unanswered';
            if (i === currentQuestion) el.classList.add('active');
        });
    }

    function buildQuestionNav() {
        const container = document.getElementById("questionNav");
        container.innerHTML = "";
        for (let i = 0; i < totalQuestions; i++) {
            const span = document.createElement("span");
            span.textContent = i + 1;
            span.onclick = () => showQuestion(i);
            span.className = "unanswered";
            container.appendChild(span);
        }
        container.style.display = "block";
    }

    function enableButtons() {
        document.getElementById("prevBtn").disabled = false;
        document.getElementById("nextBtn").disabled = false;
        document.getElementById("submitBtn").disabled = false;

        document.getElementById("prevBtn").classList.remove("disabled");
        document.getElementById("nextBtn").classList.remove("disabled");
        document.getElementById("submitBtn").classList.remove("disabled");

        document.getElementById("instruction").style.display = "none";
        document.getElementById("examForm").style.display = "block";
        document.getElementById("examTitle").style.display = "block";
        document.getElementById("progressContainer").style.display = "block";

        buildQuestionNav();
        showQuestion(0);
    }

    function updateTimer() {
        const mins = Math.floor(timeLeft / 60);
        const secs = (timeLeft % 60).toString().padStart(2, '0');
        document.getElementById("timerText").textContent = `${mins}:${secs}`;

        // timings computed from the two variables above
        const START_COUNTDOWN_AT = examDurationMinutes * 60; // Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø¨Ø¯Ø¡
        const HALF_TIME = Math.floor((examDurationMinutes * 60) / 2) + waitBeforeStartSeconds;

        const messages = {
            // Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø³Ù…ÙŠ
            [examDurationMinutes * 60 + waitBeforeStartSeconds]:
                [`âŒ› Ø³ÙŠØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ø§Ù„Ø±Ø³Ù…ÙŠ Ø®Ù„Ø§Ù„ ${waitBeforeStartSeconds} Ø«ÙˆØ§Ù†Ù. ØªØ£ÙƒØ¯ Ù…Ù† Ø¬Ø§Ù‡Ø²ÙŠØªÙƒ!`, true],

            // Ù„Ø­Ø¸Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯Ù‘ Ø§Ù„Ø±Ø³Ù…ÙŠ
            [START_COUNTDOWN_AT]:
                ["âŒ› ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ø§Ù„Ø¢Ù†. Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚!", false],

            // Ù…Ù†ØªØµÙ Ø§Ù„ÙˆÙ‚Øª
            [HALF_TIME]:
                ["â³ Ù…Ø¶Ù‰ Ù†ØµÙ Ø§Ù„ÙˆÙ‚Øª.", true],

            // 15 Ø¯Ù‚ÙŠÙ‚Ø© Ù…ØªØ¨Ù‚ÙŠØ©
            [900 + waitBeforeStartSeconds]:
                ["âš ï¸ ØªØ¨Ù‚Ù‰ 15 Ø¯Ù‚ÙŠÙ‚Ø© ÙÙ‚Ø·.", true],

            // 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ù…ØªØ¨Ù‚ÙŠØ©
            [300 + waitBeforeStartSeconds]:
                ["âš ï¸ ØªØ¨Ù‚Ù‰ 5 Ø¯Ù‚Ø§Ø¦Ù‚. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©.", true],

            // Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©
            [60 + waitBeforeStartSeconds]:
                ["âš ï¸ Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø© Ù…ØªØ¨Ù‚ÙŠØ©. Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.", true],

            // Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª
            [0]:
                ["â›” Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ Ø§Ù„Ø¢Ù†.", true]
        };

        if (messages[timeLeft] && !warned[timeLeft]) {
            const [msg, blink] = messages[timeLeft];
            showWarning(msg, blink);
            warned[timeLeft] = true;

            // Ø¹Ù†Ø¯ Ù„Ø­Ø¸Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯ Ø§Ù„Ø±Ø³Ù…ÙŠØŒ Ù†ÙØ¹Ù„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            if (timeLeft === START_COUNTDOWN_AT) enableButtons();

            // Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª Ù†Ø±Ø³Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            if (timeLeft === 0) document.getElementById("examForm").submit();
        }

        timeLeft--;
        setTimeout(updateTimer, 1000);
    }

    function confirmIncompleteSubmission() {
        const allAnswered = answered.every(Boolean);
        if (!allAnswered && timeLeft > 0) {
            return confirm("âš ï¸ Ù„Ù… ØªÙØ¬Ø¨ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¢Ù†ØŸ");
        }
        return true;
    }

    function updateProgressBar() {
        const answeredCount = answered.filter(Boolean).length;
        const percent = Math.floor((answeredCount / totalQuestions) * 100);
        document.getElementById("progressBar").style.width = `${percent}%`;
    }

    document.addEventListener('keydown', function (e) {
        const focused = document.activeElement;

        if (e.key === 'Enter' && focused && focused.type === 'radio') {
            focused.checked = true;
            const index = parseInt(focused.name.replace(/[^\d]/g, ''));
            if (!isNaN(index)) { markAnswered(index); }
        }
        if (e.key === 'ArrowLeft') { prevQuestion(); }
        else if (e.key === 'ArrowRight') { nextQuestion(); }
    });
</script>
</body>
</html>
